name = "overlap"
compatibility_date = "2026-01-15"
compatibility_flags = ["nodejs_compat"]

# Workers deployment - main entry point from Astro build
main = "dist/_worker.js/index.js"

# Static assets configuration
[assets]
directory = "dist"
binding = "ASSETS"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "overlap-db"

# KV namespace for Astro sessions (@astrojs/cloudflare requires this)
[[kv_namespaces]]
binding = "SESSION"

# Environment variables
[vars]
ENVIRONMENT = "production"

# Note: TEAM_ENCRYPTION_KEY must be set as a secret during setup

# Stale session detection runs on authenticated page loads (no cron needed).
# Astro's Cloudflare adapter doesn't export scheduled(), so cron triggers
# would produce "Handler does not export a scheduled() function" errors.

# Enable worker logs for debugging
[observability]
[observability.logs]
enabled = true
invocation_logs = true
